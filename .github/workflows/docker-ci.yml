name: Docker CI Build and Lint

on:
  push:
    branches:
      - main

jobs:
  build_and_test:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Build and Lint Collector API
        run: |
          echo "Starting Collector API build and test..."
          docker build -t collector-image:latest -f Dockerfile .
          
          echo "Running Python Linting/Tests (Simulated)..."
          docker run --rm collector-image:latest sh -c "pip install flake8 && flake8 main.py"
        working-directory: ./log-analytics/collector-api

      - name: Build and Lint Query API
        run: |
          echo "Starting Query API build and test..."
          docker build -t query-image:latest -f Dockerfile .
          
          echo "Running Python Linting/Tests (Simulated)..."
          docker run --rm query-image:latest sh -c "pip install flake8 && flake8 main.py"
        working-directory: ./log-analytics/query-api

      - name: CI Success
        run: echo "All Docker builds passed. Code is ready for deployment."